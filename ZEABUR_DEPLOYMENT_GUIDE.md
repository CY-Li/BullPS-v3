# 🚀 Zeabur 部署指南

## 📋 部署步驟

### 1. **推送代碼到 GitHub**
```bash
git add .
git commit -m "完成統一路徑系統和權限修復功能"
git push origin main
```

### 2. **在 Zeabur 部署**
1. 登入 Zeabur 控制台
2. 創建新項目或選擇現有項目
3. 連接 GitHub 倉庫
4. 選擇自動部署
5. 等待部署完成

---

## 🔧 權限修復方法

### **方法 1：使用前端修復按鈕（推薦）**

1. **訪問部署的應用程式**
   ```
   https://your-app.zeabur.app
   ```

2. **點擊「修復權限」按鈕**
   - 位置：主界面右上角，「立即更新」按鈕旁邊
   - 圖標：🔧 修復權限
   - 功能：自動修復所有數據文件的權限

3. **查看修復結果**
   - 成功：顯示「權限修復完成：X/3 個文件修復成功」
   - 失敗：顯示錯誤信息

### **方法 2：使用 API 端點**

直接調用權限修復 API：
```bash
curl -X POST https://your-app.zeabur.app/api/fix-permissions
```

**響應示例**：
```json
{
  "status": "completed",
  "timestamp": "2025-07-15T12:00:00+08:00",
  "permission_fixes": [
    {
      "file": "/app/data/analysis_result.json",
      "status": "success",
      "message": "權限修復成功"
    }
  ],
  "summary": {
    "total_files": 3,
    "fixed": 3,
    "failed": 0,
    "writable": 3
  }
}
```

---

## 🎯 使用場景

### **何時需要修復權限？**

1. **手動更新數據後**
   - 通過 Zeabur 控制台上傳文件
   - 通過 SSH 或其他方式修改文件
   - 文件所有者變成 root

2. **出現權限錯誤時**
   - 前端「立即更新」失敗
   - API 返回權限錯誤
   - 日誌顯示 "Permission denied"

3. **定期維護**
   - 每次重大數據更新後
   - 系統異常重啟後
   - 懷疑權限問題時

---

## 📊 權限修復功能說明

### **修復的文件**
- `/app/data/analysis_result.json` - 股票分析結果
- `/app/data/monitored_stocks.json` - 監控股票清單
- `/app/data/trade_history.json` - 交易歷史記錄

### **修復操作**
1. **檢查當前權限**：顯示文件當前的權限狀態
2. **設置正確權限**：將權限設為 `664` (rw-rw-r--)
3. **測試寫入權限**：驗證應用程式能否正常寫入
4. **返回詳細報告**：顯示每個文件的修復結果

### **安全性**
- ✅ 只修復指定的數據文件
- ✅ 不會影響系統文件
- ✅ 權限設置符合最小權限原則
- ✅ 操作日誌完整記錄

---

## 🔍 故障排除

### **權限修復失敗**

**可能原因**：
1. 文件系統只讀
2. 容器權限限制
3. 文件不存在

**解決方案**：
1. 檢查 Zeabur 日誌
2. 重新部署應用程式
3. 聯繫 Zeabur 支持

### **寫入測試失敗**

**可能原因**：
1. 磁盤空間不足
2. 文件被鎖定
3. 權限修復不完整

**解決方案**：
1. 重新運行權限修復
2. 重啟應用程式
3. 檢查磁盤使用情況

---

## 📈 監控和維護

### **健康檢查**
定期訪問健康檢查端點：
```
GET https://your-app.zeabur.app/api/health
```

### **權限狀態檢查**
調用權限修復 API 查看當前狀態：
```
POST https://your-app.zeabur.app/api/fix-permissions
```

### **日誌監控**
在 Zeabur 控制台查看應用程式日誌：
- 權限錯誤：`Permission denied`
- 寫入失敗：`Cannot write to file`
- 修復成功：`權限修復成功`

---

## 🎉 部署後驗證

### **功能測試清單**

- [ ] **應用程式啟動**：訪問主頁正常加載
- [ ] **API 端點**：所有 API 正常響應
- [ ] **數據顯示**：三個標籤頁都有數據
- [ ] **立即更新**：前端更新功能正常
- [ ] **權限修復**：修復按鈕正常工作
- [ ] **數據寫入**：更新後數據正確保存

### **測試步驟**

1. **基本功能測試**
   ```bash
   curl https://your-app.zeabur.app/api/health
   curl https://your-app.zeabur.app/api/analysis
   ```

2. **權限修復測試**
   ```bash
   curl -X POST https://your-app.zeabur.app/api/fix-permissions
   ```

3. **前端功能測試**
   - 訪問主頁
   - 點擊「立即更新」
   - 點擊「修復權限」
   - 檢查三個標籤頁數據

---

## 🚀 成功部署標誌

當您看到以下情況時，說明部署成功：

✅ **Zeabur 控制台顯示「Running」**  
✅ **健康檢查返回 200 OK**  
✅ **前端界面正常加載**  
✅ **API 端點返回數據**  
✅ **權限修復功能可用**  
✅ **立即更新功能正常**  

---

## 📞 支持

如果遇到問題：

1. **檢查 Zeabur 日誌**：查看詳細錯誤信息
2. **使用權限修復**：嘗試修復權限問題
3. **重新部署**：如果問題持續存在
4. **聯繫支持**：提供詳細的錯誤日誌

**祝您部署成功！** 🎯
