# ğŸ” BullPS-v3 è·¯å¾‘ä¸€è‡´æ€§å®Œæ•´æª¢æŸ¥å ±å‘Š

## ğŸ“‹ æª¢æŸ¥ç¯„åœ

æª¢æŸ¥æ•´å€‹å°ˆæ¡ˆä¸­æ‰€æœ‰è®€å¯« JSON æ•¸æ“šæ–‡ä»¶çš„ä»£ç¢¼ï¼Œç¢ºä¿å‰ç«¯åŸ·è¡Œæ›´æ–°æ™‚æ‰€æœ‰ç¯€é»éƒ½ä½¿ç”¨åŒä¸€ä»½æ–‡ä»¶ã€‚

**æª¢æŸ¥çš„æ–‡ä»¶**:
- `analysis_result.json` - è‚¡ç¥¨åˆ†æçµæœ
- `monitored_stocks.json` - ç›£æ§è‚¡ç¥¨æ¸…å–®  
- `trade_history.json` - äº¤æ˜“æ­·å²è¨˜éŒ„

---

## ğŸ“Š è·¯å¾‘ä½¿ç”¨åˆ†æ

### 1. **çµ±ä¸€è·¯å¾‘ç®¡ç†å™¨** (`backend/path_manager.py`)

**è¨­è¨ˆåŸå‰‡**: 
```python
# çµ±ä¸€æ•¸æ“šç›®éŒ„é‚è¼¯
if Path("/app").exists():
    data_dir = Path("/app/data")      # å®¹å™¨ç’°å¢ƒ
else:
    data_dir = self.base_dir / "data" # æœ¬åœ°ç’°å¢ƒ

# æ‰€æœ‰æ–‡ä»¶éƒ½åœ¨çµ±ä¸€ç›®éŒ„ä¸‹
files = {
    "analysis_result.json": data_dir / "analysis_result.json",
    "monitored_stocks.json": data_dir / "monitored_stocks.json", 
    "trade_history.json": data_dir / "trade_history.json"
}
```

**ç‹€æ…‹**: âœ… **å®Œå…¨çµ±ä¸€**

### 2. **å‰ç«¯ API èª¿ç”¨** (`frontend/src/App.tsx`)

**è®€å–ç«¯é»**:
```typescript
const [a, monitored, history] = await Promise.all([
    axios.get("/api/analysis"),        // è®€å–åˆ†æçµæœ
    axios.get("/api/monitored-stocks"), // è®€å–ç›£æ§è‚¡ç¥¨
    axios.get("/api/trade-history"),   // è®€å–äº¤æ˜“æ­·å²
]);
```

**è§¸ç™¼æ›´æ–°**:
```typescript
await axios.post("/api/run-now"); // è§¸ç™¼åˆ†ææ›´æ–°
```

**ç‹€æ…‹**: âœ… **çµ±ä¸€ä½¿ç”¨ API ç«¯é»**

### 3. **å¾Œç«¯ API ç«¯é»** (`backend/main.py`)

**è·¯å¾‘é…ç½®**:
```python
# ä½¿ç”¨çµ±ä¸€è·¯å¾‘ç®¡ç†å™¨
ANALYSIS_PATH = path_manager.get_analysis_path()
MONITORED_STOCKS_PATH = path_manager.get_monitored_stocks_path()  
TRADE_HISTORY_PATH = path_manager.get_trade_history_path()
```

**è®€å–ç«¯é»**:
- `/api/analysis` â†’ è®€å– `ANALYSIS_PATH`
- `/api/monitored-stocks` â†’ è®€å– `MONITORED_STOCKS_PATH`
- `/api/trade-history` â†’ è®€å– `TRADE_HISTORY_PATH`

**ç‹€æ…‹**: âœ… **ä½¿ç”¨çµ±ä¸€è·¯å¾‘è®Šæ•¸**

### 4. **è‚¡ç¥¨åˆ†æå™¨** (`integrated_stock_analyzer.py`)

**å¯«å…¥é‚è¼¯**:
```python
# åˆ†æçµæœå¯«å…¥
from backend.path_manager import get_analysis_path
analysis_path = get_analysis_path()
with open(analysis_path, 'w', encoding='utf-8') as f:
    json.dump(analysis_result, f, ...)

# ç›£æ§è‚¡ç¥¨å¯«å…¥  
from backend.path_manager import get_monitored_stocks_path
MONITORED_STOCKS_PATH = get_monitored_stocks_path()
with open(MONITORED_STOCKS_PATH, 'w', encoding='utf-8') as f:
    json.dump(monitored_stocks, f, ...)
```

**ç‹€æ…‹**: âœ… **ä½¿ç”¨çµ±ä¸€è·¯å¾‘ç®¡ç†å™¨**

### 5. **æŠ•è³‡çµ„åˆç®¡ç†å™¨** (`backend/portfolio_manager.py`)

**è·¯å¾‘é…ç½®**:
```python
# ä½¿ç”¨çµ±ä¸€è·¯å¾‘å‡½æ•¸
PORTFOLIO_FILE = get_unified_file_path("monitored_stocks.json")
ANALYSIS_RESULT_FILE = get_unified_file_path("analysis_result.json")
TRADE_HISTORY_FILE = get_unified_file_path("trade_history.json")
```

**è®€å¯«æ“ä½œ**:
- `load_json_file(PORTFOLIO_FILE)` - è®€å–ç›£æ§è‚¡ç¥¨
- `save_json_file(data, PORTFOLIO_FILE)` - å¯«å…¥ç›£æ§è‚¡ç¥¨
- `load_json_file(TRADE_HISTORY_FILE)` - è®€å–äº¤æ˜“æ­·å²
- `save_json_file(trade_history, TRADE_HISTORY_FILE)` - å¯«å…¥äº¤æ˜“æ­·å²

**ç‹€æ…‹**: âœ… **ä½¿ç”¨çµ±ä¸€è·¯å¾‘å‡½æ•¸**

---

## ğŸ¯ è·¯å¾‘ä¸€è‡´æ€§é©—è­‰

### **æœ¬åœ°ç’°å¢ƒè·¯å¾‘**
```
é …ç›®æ ¹ç›®éŒ„/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ analysis_result.json     â† æ‰€æœ‰çµ„ä»¶è®€å¯«æ­¤æ–‡ä»¶
â”‚   â”œâ”€â”€ monitored_stocks.json    â† æ‰€æœ‰çµ„ä»¶è®€å¯«æ­¤æ–‡ä»¶
â”‚   â””â”€â”€ trade_history.json       â† æ‰€æœ‰çµ„ä»¶è®€å¯«æ­¤æ–‡ä»¶
```

### **å®¹å™¨ç’°å¢ƒè·¯å¾‘**
```
/app/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ analysis_result.json     â† æ‰€æœ‰çµ„ä»¶è®€å¯«æ­¤æ–‡ä»¶
â”‚   â”œâ”€â”€ monitored_stocks.json    â† æ‰€æœ‰çµ„ä»¶è®€å¯«æ­¤æ–‡ä»¶
â”‚   â””â”€â”€ trade_history.json       â† æ‰€æœ‰çµ„ä»¶è®€å¯«æ­¤æ–‡ä»¶
```

### **å‰ç«¯æ›´æ–°æµç¨‹**
```
1. ç”¨æˆ¶é»æ“Šã€Œç«‹å³æ›´æ–°ã€
   â†“
2. å‰ç«¯èª¿ç”¨ POST /api/run-now
   â†“
3. å¾Œç«¯åŸ·è¡Œ integrated_stock_analyzer.py
   â†“
4. åˆ†æå™¨å¯«å…¥çµ±ä¸€è·¯å¾‘:
   - analysis_result.json
   - monitored_stocks.json (å¦‚æœ‰æ–°å¢)
   â†“
5. æŠ•è³‡çµ„åˆç®¡ç†å™¨è®€å¯«çµ±ä¸€è·¯å¾‘:
   - monitored_stocks.json
   - trade_history.json
   â†“
6. å‰ç«¯é‡æ–°èª¿ç”¨ API è®€å–æ›´æ–°å¾Œçš„æ•¸æ“š:
   - GET /api/analysis
   - GET /api/monitored-stocks  
   - GET /api/trade-history
   â†“
7. å¾Œç«¯ API å¾çµ±ä¸€è·¯å¾‘è®€å–ä¸¦è¿”å›æ•¸æ“š
```

---

## âœ… ä¸€è‡´æ€§æª¢æŸ¥çµæœ

### **å®Œå…¨ä¸€è‡´çš„çµ„ä»¶** âœ…

| çµ„ä»¶ | è®€å–è·¯å¾‘ | å¯«å…¥è·¯å¾‘ | ç‹€æ…‹ |
|------|----------|----------|------|
| **å‰ç«¯** | API ç«¯é» | API ç«¯é» | âœ… çµ±ä¸€ |
| **å¾Œç«¯ API** | çµ±ä¸€è·¯å¾‘è®Šæ•¸ | çµ±ä¸€è·¯å¾‘è®Šæ•¸ | âœ… çµ±ä¸€ |
| **åˆ†æå™¨** | çµ±ä¸€è·¯å¾‘ç®¡ç†å™¨ | çµ±ä¸€è·¯å¾‘ç®¡ç†å™¨ | âœ… çµ±ä¸€ |
| **æŠ•è³‡çµ„åˆç®¡ç†å™¨** | çµ±ä¸€è·¯å¾‘å‡½æ•¸ | çµ±ä¸€è·¯å¾‘å‡½æ•¸ | âœ… çµ±ä¸€ |
| **è·¯å¾‘ç®¡ç†å™¨** | çµ±ä¸€æ•¸æ“šç›®éŒ„ | çµ±ä¸€æ•¸æ“šç›®éŒ„ | âœ… çµ±ä¸€ |

### **æ•¸æ“šæµä¸€è‡´æ€§** âœ…

```
å¯«å…¥: åˆ†æå™¨ â†’ çµ±ä¸€è·¯å¾‘ â† æŠ•è³‡çµ„åˆç®¡ç†å™¨
                    â†•
è®€å–: å¾Œç«¯ API â† çµ±ä¸€è·¯å¾‘ â†’ å‰ç«¯ API èª¿ç”¨
```

### **ç’°å¢ƒå…¼å®¹æ€§** âœ…

- **æœ¬åœ°é–‹ç™¼**: `./data/*.json`
- **å®¹å™¨éƒ¨ç½²**: `/app/data/*.json`
- **è·¯å¾‘æª¢æ¸¬**: è‡ªå‹•é©æ‡‰ç’°å¢ƒ

---

## ğŸ‰ çµè«–

### **è·¯å¾‘å®Œå…¨çµ±ä¸€** âœ…

ç¶“éå®Œæ•´æª¢æŸ¥ï¼Œç¢ºèªï¼š

1. **å–®ä¸€æ•¸æ“šæº**: ç„¡è«–æœ¬åœ°æˆ–é›²ç«¯ï¼Œéƒ½åªæœ‰ä¸€ä»½ JSON æ–‡ä»¶
2. **çµ±ä¸€è®€å¯«**: æ‰€æœ‰çµ„ä»¶éƒ½ä½¿ç”¨ç›¸åŒçš„è·¯å¾‘é‚è¼¯
3. **ç„¡è·¯å¾‘è¡çª**: æ¶ˆé™¤äº†ä¹‹å‰çš„å¤šè·¯å¾‘å•é¡Œ
4. **è‡ªå‹•é©æ‡‰**: æœ¬åœ°å’Œå®¹å™¨ç’°å¢ƒè‡ªå‹•ä½¿ç”¨æ­£ç¢ºè·¯å¾‘

### **å‰ç«¯æ›´æ–°æµç¨‹ä¿è­‰** âœ…

ç•¶ç”¨æˆ¶åœ¨å‰ç«¯é»æ“Šã€Œç«‹å³æ›´æ–°ã€æ™‚ï¼š

1. âœ… **åˆ†æå™¨å¯«å…¥** â†’ çµ±ä¸€è·¯å¾‘
2. âœ… **æŠ•è³‡çµ„åˆç®¡ç†å™¨è®€å¯«** â†’ çµ±ä¸€è·¯å¾‘  
3. âœ… **å¾Œç«¯ API è®€å–** â†’ çµ±ä¸€è·¯å¾‘
4. âœ… **å‰ç«¯é¡¯ç¤º** â†’ ä¾†è‡ªçµ±ä¸€è·¯å¾‘çš„æ•¸æ“š

### **æŠ€è¡“å„ªå‹¢** ğŸš€

- **æ•¸æ“šä¸€è‡´æ€§**: æ¶ˆé™¤è®€å¯«ä¸åŒæ­¥å•é¡Œ
- **ç°¡åŒ–ç¶­è­·**: å–®ä¸€è·¯å¾‘é‚è¼¯ï¼Œæ˜“æ–¼ç®¡ç†
- **æé«˜æ€§èƒ½**: æ¸›å°‘æ–‡ä»¶åŒæ­¥é–‹éŠ·
- **é¿å…éŒ¯èª¤**: æ¶ˆé™¤è·¯å¾‘é…ç½®éŒ¯èª¤

### **éƒ¨ç½²å»ºè­°** ğŸ“

1. **ç¢ºä¿æ•¸æ“šç›®éŒ„**: æœ¬åœ° `./data/`ï¼Œå®¹å™¨ `/app/data/`
2. **æ¬Šé™è¨­ç½®**: ç¢ºä¿æ‡‰ç”¨ç¨‹å¼æœ‰è®€å¯«æ¬Šé™
3. **å‚™ä»½ç­–ç•¥**: å®šæœŸå‚™ä»½çµ±ä¸€æ•¸æ“šç›®éŒ„
4. **ç›£æ§æª¢æŸ¥**: å®šæœŸé©—è­‰è·¯å¾‘ä¸€è‡´æ€§

---

**æª¢æŸ¥å®Œæˆæ™‚é–“**: 2025-07-15  
**æª¢æŸ¥çµæœ**: âœ… **è·¯å¾‘å®Œå…¨çµ±ä¸€ï¼Œç„¡ä¸€è‡´æ€§å•é¡Œ**  
**å»ºè­°**: å¯ä»¥å®‰å…¨éƒ¨ç½²ï¼Œæ‰€æœ‰çµ„ä»¶ä½¿ç”¨åŒä¸€ä»½æ•¸æ“šæ–‡ä»¶
